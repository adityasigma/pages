{% load static %}
<div class="container my-5">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
<!-- <link rel="stylesheet" href="{% static 'css/demo.css' %}" /> -->
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
crossorigin="anonymous"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/jquery-ui.min.js"></script>

<link rel="stylesheet" href="https://cdn.datatables.net/1.11.4/css/jquery.dataTables.min.css" />
<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script src="https://cdn.datatables.net/1.11.4/js/jquery.dataTables.min.js"></script>
<style>
textarea {
    width: 250px;
    height: 250px;
    white-space: pre;
    word-wrap: normal;
    overflow-x: scroll;
}
</style>
<style type="text/css">
table {
    background: #fff;
}

.paging-nav {
    text-align: center;
    padding-top: 2px;
}

.paging-nav a {
    margin: auto 1px;
    text-decoration: none;
    display: inline-block;
    padding: 1px 7px;
    background: #91b9e6;
    color: white;
    border-radius: 3px;
}

.paging-nav .selected-page {
    background: #187ed5;
    font-weight: bold;
}

.paging-nav,
#tableData {
    width: 400px;
    margin: 0 auto;
    font-family: Arial, sans-serif;
}
</style>

<ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
<li class="nav-item">
    <a class="nav-link active" id="pills-home-tab" data-toggle="pill" href="#pills-home" role="tab"
        aria-controls="pills-home" aria-selected="true">Home</a>
</li>
<li class="nav-item">
    <a class="nav-link" id="pills-log-tab" data-toggle="pill" href="#pills-log" role="tab"
        aria-controls="pills-log" aria-selected="false">Logs</a>
</li>
</ul>
<div class="tab-content" id="pills-tabContent">
<div class="tab-pane fade show active" id="pills-home" role="tabpanel" aria-labelledby="pills-home-tab">
    <table class="table" id="userTable">
        <thead>
            <tr>
                <th scope="col">Id</th>
                <th scope="col">Username</th>
                <th scope="col">First Name</th>
                <th scope="col">Last Name</th>
            </tr>
        </thead>
        <tbody>
            <!-- <tr>
            <th scope="row">1</th>
            <td>Mark</td>
            <td>Otto</td>
            <td>@mdo</td>
        </tr> -->
        </tbody>
    </table>

    <div class="d-flex justify-content-between my-5">
        <div class="card d-flex justify-content-between" style="width: 18rem;">
            <div class="card-body">
                <h6 class="card-subtitle mb-2 text-muted">Request</h6>
                <form method="post">
                    {% csrf_token %}
                    <input type="text" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp"
                        placeholder="Id">
                    <input type="text" class="form-control" id="exampleInputEmail2" name="username"
                        aria-describedby="emailHelp" placeholder="Username">
                    <input type="text" class="form-control" id="exampleInputEmail3" name="password"
                        aria-describedby="emailHelp" placeholder="Password">
                    <input type="text" class="form-control" id="exampleInputEmail4" name="first_name"
                        aria-describedby="emailHelp" placeholder="First Name">
                    <input type="text" class="form-control" id="exampleInputEmail5" name="last_name"
                        aria-describedby="emailHelp" placeholder="Last Name">

                    <!-- <a href="#" class="card-link">Card link</a>
                                <a href="#" class="card-link">Another link</a> -->
                    <input class="btn btn-dark" id="submit1" type="button" value="Submit"
                        onclick="GetAPICall()" />
                    <input class="btn btn-dark" id="submit2" type="button" value="Submit"
                        onclick="PostAPICall()" />
                    <input class="btn btn-dark" id="submit3" type="button" value="Submit"
                        onclick="PutAPICall()" />
                    <input class="btn btn-dark" id="submit4" type="button" value="Submit"
                        onclick="DeleteAPICall()" />
                </form>
            </div>
        </div>
        <div style="width: 18rem;">
            <input class="btn btn-primary" type="button" value="Get" onclick="ShowHideDivGet(this)" />
            <input class="btn btn-success" type="button" value="Post" onclick="ShowHideDivPost(this)" />
            <input class="btn btn-info" type="button" value="Put" onclick="ShowHideDivPut(this)" />
            <input class="btn btn-danger" type="button" value="Delete" onclick="ShowHideDivDelete(this)" />
        </div>

        <div class="card" style="width: 18rem;">
            <div class="card-body">
                <h6 class="card-subtitle mb-2 text-muted">Response</h6>
                <div id="res_id"></div>
                <textarea wrap="hard">
        </textarea>
            </div>
        </div>
    </div>
</div>
<div class="tab-pane fade" id="pills-log" role="tabpanel" aria-labelledby="pills-log-tab">
    <table class="table" data-order='[[ 0, "desc" ]]' id="logTable">
        <thead>
            <tr>
                <th scope="col">Id</th>
                <th scope="col">Request Type</th>
                <th scope="col">Request Body</th>
                <th scope="col">Request Time</th>
                <th scope="col">Response</th>
                <th scope="col">Response Time</th>
            </tr>
        </thead>
        <tbody>
            <!-- <tr>
            <th scope="row">1</th>
            <td>Mark</td>
            <td>Otto</td>
            <td>@mdo</td>
        </tr> -->
        </tbody>
    </table>

</div>


<script>
    $(document).ready(function () {
        //This will execute onload oof your web page what you required
        getUserList();
        getLogList();
        $("#exampleInputEmail1").hide();
        $("#exampleInputEmail2").hide();
        $("#exampleInputEmail3 ").hide();
        $("#exampleInputEmail4").hide();
        $("#exampleInputEmail5").hide();
        $("#submit1").hide();
        $("#submit2").hide();
        $("#submit3").hide();
        $("#submit4").hide();
    })

    function getUserList() {
        $.ajax({
            type: "GET",
            url: "/all_users_list/",
            success: function (response) {
                $('#userTable tbody').empty();
                $('#userTable').dataTable().fnClearTable();
                $('#userTable').dataTable().fnDraw();
                $('#userTable').dataTable().fnDestroy();
                var trHTML = '';
                $.each(response, function (i, item) {
                    trHTML += '<tr><td>' + item.id + '</td><td>' + item.username + '</td><td>' + item.first_name + '</td><td>' + item.last_name + '</td></tr>';
                });
                $('#userTable').find('tbody').append(trHTML);
                // $('#userTable tbody').append(trHTML);
                $("#userTable").DataTable();
            }
        });
    }
    
    function getLogList() {
        $.ajax({
            type: "GET",
            url: "/all_log/",
            success: function (response) {
                $('#logTable tbody').empty();
                $('#logTable').dataTable().fnClearTable();
                $('#logTable').dataTable().fnDraw();
                $('#logTable').dataTable().fnDestroy();
                var trHTML = '';
                console.log(response) 
                $.each(response, function (i, item)
                {
                    trHTML += '<tr><td>' + item.id + '</td><td>' + item.request_type + '</td><td>' + item.request_body + '</td><td>' + item.request_time + '</td><td>'+ item.response + '</td><td>'+ item.response_time + '</td></tr>';
                });
                $('#logTable').find('tbody').append(trHTML);
                // $('#userTable tbody').append(trHTML);
                $("#logTable").DataTable().reverse();
            }
        });
    }

    function GetAPICall() {

        var Id = document.getElementById('exampleInputEmail1').value;

        $.ajax({
            type: "GET",
            url: "/users_list/" + Id,

            success: function (response) {
                console.log(response)
                $('textarea').text(JSON.stringify(response, null, '\t'));
                getUserList();
                getLogList();
            }
        });
    }

    function PostAPICall() {
        var $crf_token = $('[name="csrfmiddlewaretoken"]').attr('value');

        var formData = {
            'username': $('input[name=username]').val(),
            'password': $('input[name=password]').val(),
            'first_name': $('input[name=first_name]').val(),
            'last_name': $('input[name=last_name]').val(),
        };

        $.ajax({
            type: "POST",
            url: "/users_list/",
            headers: { "X-CSRFToken": $crf_token },
            data: formData,

            success: function (response) {
                console.log(response)
                $('textarea').text(JSON.stringify(response, null, '\t'));
                getUserList();
                getLogList();
                // $("#userTable").DataTable();
            }
        });
    }

    function PutAPICall() {

        var Id = document.getElementById('exampleInputEmail1').value;
        var $crf_token = $('[name="csrfmiddlewaretoken"]').attr('value');

        var formData = {
            'username': $('input[name=username]').val(),
            'password': $('input[name=password]').val(),
            'first_name': $('input[name=first_name]').val(),
            'last_name': $('input[name=last_name]').val(),
        };

        $.ajax({
            type: "PUT",
            url: "/users_list/" + Id,
            headers: { "X-CSRFToken": $crf_token },
            data: formData,

            success: function (response) {
                console.log(response)
                $('textarea').text(JSON.stringify(response, null, '\t'));
                getUserList();
                getLogList();
            }
        });
    }

    function DeleteAPICall() {

        var Id = document.getElementById('exampleInputEmail1').value;
        var $crf_token = $('[name="csrfmiddlewaretoken"]').attr('value');

        $.ajax({
            type: "DELETE",
            url: "/users_list/" + Id,
            headers: { "X-CSRFToken": $crf_token },
            // data: formData,

            success: function (response) {
                console.log(response);
                $('textarea').text(JSON.stringify(response, null, '\t'));
                getUserList();
                getLogList();
            },

            error: function (response) {
                console.log(response);
                $('textarea').text(JSON.stringify(response, null, '\t'));
                getUserList();
            }
        });
    }

    function ShowHideDivGet(btnPassport) {
        $("#exampleInputEmail1").show();
        $("#exampleInputEmail2").hide();
        $("#exampleInputEmail3").hide();
        $("#exampleInputEmail4").hide();
        $("#exampleInputEmail5").hide();
        $("#submit1").show();
        $("#submit2").hide();
        $("#submit3").hide();
        $("#submit4").hide();
        document.getElementById('exampleInputEmail1').value = null;
        document.getElementById('exampleInputEmail2').value = null;
        document.getElementById('exampleInputEmail3').value = null;
        document.getElementById('exampleInputEmail4').value = null;
        document.getElementById('exampleInputEmail5').value = null;
    }

    function ShowHideDivPost(btnPassport) {
        $("#exampleInputEmail1").hide();
        $("#exampleInputEmail2").show();
        $("#exampleInputEmail3").show();
        $("#exampleInputEmail4").show();
        $("#exampleInputEmail5").show();
        $("#submit2").show();
        $("#submit1").hide();
        $("#submit3").hide();
        $("#submit4").hide();
        document.getElementById('exampleInputEmail1').value = null;
        document.getElementById('exampleInputEmail2').value = null;
        document.getElementById('exampleInputEmail3').value = null;
        document.getElementById('exampleInputEmail4').value = null;
        document.getElementById('exampleInputEmail5').value = null;
    }

    function ShowHideDivPut(btnPassport) {
        $("#exampleInputEmail1").show();
        $("#exampleInputEmail2").show();
        $("#exampleInputEmail3").show();
        $("#exampleInputEmail4").show();
        $("#exampleInputEmail5").show();
        $("#submit3").show();
        $("#submit2").hide();
        $("#submit1").hide();
        $("#submit4").hide();
        document.getElementById('exampleInputEmail1').value = null;
        document.getElementById('exampleInputEmail2').value = null;
        document.getElementById('exampleInputEmail3').value = null;
        document.getElementById('exampleInputEmail4').value = null;
        document.getElementById('exampleInputEmail5').value = null;
    }

    function ShowHideDivDelete(btnPassport) {
        $("#exampleInputEmail1").show();
        $("#exampleInputEmail2").hide();
        $("#exampleInputEmail3").hide();
        $("#exampleInputEmail4").hide();
        $("#exampleInputEmail5").hide();
        $("#submit4").show();
        $("#submit2").hide();
        $("#submit3").hide();
        $("#submit1").hide();
        document.getElementById('exampleInputEmail1').value = null;
        document.getElementById('exampleInputEmail2').value = null;
        document.getElementById('exampleInputEmail3').value = null;
        document.getElementById('exampleInputEmail4').value = null;
        document.getElementById('exampleInputEmail5').value = null;
    }
</script>